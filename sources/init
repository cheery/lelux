#!/bin/sh

# /init is the very first program run by the linux kernel. It is also the
# first file the lelux author would want you to read when getting
# accustomized to Lelux.

# Many Linux systems boot into a "mini filesystem" called the initramfs.
# It is a temporary filesystem that is populated by an archive. The archive
# contains just enough functionality to load the full system.

# Generally good commenting practice is to describe why rather than what
# so learn to search up every command and flag that you do not understand.
# It is up to the good distribution maintainer to keep things short.

# We boot up with only /bin/sh. Our initial filesystem could contain other
# links, but I preferred operations happening inside lelux.
/bin/busybox mkdir -p usr/bin usr/sbin sys proc dev tmp sbin etc
/bin/busybox --install

export PATH=/usr/local/bin:/bin:/usr/bin:/sbin

# Many common linux programs expect that there are some system files
# present they can use to interact with the kernel.
mount -t devtmpfs devfs /dev
mount -t proc proc /proc
mount -t sysfs sysfs /sys
mount -t tmpfs tmpfs /tmp


# This could be any other name.
hostname lelux

# http://www.tty1.net/blog/2010-04-21-ifconfig-ip-comparison_en.html
# The network needs to be configured if we want userland programs to
# access the internet. 

ip link set lo up
ip link set eth0 up

# The most common config today is to let network devices configure themselves.
# We pass a script to a small utility program, that ends up to the background.
udhcpc -b -s /on-dhcp-event

# The /etc/hosts would be commonly static, it is a set of addresses that
# are associated to names. Commonly it just contains the famous localhost entry.
cat > /etc/hosts << EOF
# generated by /init
127.0.0.1   localhost
EOF

echo 'lelux-0.1' > /etc/lelux-version # Identify the distribution.
echo 0 > /proc/sys/kernel/printk      # Disable kernel messages 
exec /bin/sh
